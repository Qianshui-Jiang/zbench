seqlen = 1024
d = 64
dropout_p = 0.17
causal = False
local = False
dtype = torch.float16
device = cuda
batch_size = 2
nheads = 3
window_size = (-1, -1)
qkv = tensor([[[[[-9.2480e-01, -4.2529e-01, -2.6445e+00,  ...,  1.2103e-01,
             4.7290e-01, -1.0820e+00],
           [-3.3447e-02, -9.7363e-01,  9.5605e-01,  ..., -2.1277e-01,
            -3.3154e-01, -2.0227e-01],
           [-1.1455e+00, -5.7129e-01, -6.5088e-01,  ...,  2.1448e-01,
            -7.3682e-01, -4.5166e-01]],

          [[-1.3550e-01, -1.3174e+00, -8.7402e-01,  ...,  1.3418e+00,
             3.3164e+00, -8.4668e-01],
           [ 2.3743e-01,  1.0889e+00, -2.4976e-01,  ...,  1.9092e+00,
            -8.1885e-01, -6.7627e-01],
           [ 1.4238e+00,  9.2432e-01,  2.1204e-01,  ...,  2.4304e-01,
             1.7029e-01, -2.1106e-01]],

          [[-1.2463e-01,  1.3306e-01, -8.1348e-01,  ..., -5.2637e-01,
             7.0996e-01, -3.8269e-02],
           [ 1.6533e+00, -1.0166e+00,  7.9541e-01,  ..., -3.1885e-01,
             1.4023e+00,  6.5576e-01],
           [-1.1094e+00, -3.7622e-01,  1.0078e+00,  ..., -2.4731e-01,
             7.0850e-01, -1.0215e+00]],

          ...,

          [[-2.6587e-01, -7.1680e-01, -9.1943e-01,  ...,  1.4170e+00,
             8.8428e-01, -1.8066e-01],
           [-3.3911e-01,  5.0537e-01,  7.7588e-01,  ..., -1.6357e-01,
             3.6938e-01,  2.0239e-01],
           [-3.3936e-01, -5.0049e-02, -3.9722e-01,  ...,  3.1592e-01,
            -1.1836e+00,  8.5889e-01]],

          [[-2.7612e-01, -1.2031e+00,  7.4658e-01,  ...,  8.2275e-02,
             6.5283e-01, -8.5059e-01],
           [ 1.6937e-02, -1.6143e+00, -5.4102e-01,  ..., -9.8975e-01,
             8.7305e-01,  4.8486e-01],
           [-5.1465e-01, -2.4670e-01, -8.7598e-01,  ..., -1.2822e+00,
            -5.6836e-01, -1.7615e-01]],

          [[ 1.3037e-01,  1.7236e+00,  1.5381e-01,  ..., -1.8970e-01,
             8.4473e-02, -6.9873e-01],
           [-9.7412e-01, -6.2109e-01,  5.9473e-01,  ..., -1.1650e+00,
             1.9365e+00, -1.3096e+00],
           [-8.4229e-02,  9.2090e-01, -2.9419e-01,  ...,  4.1089e-01,
            -1.7031e+00, -8.3008e-01]]],


         [[[-5.1953e-01,  1.5557e+00, -6.6016e-01,  ..., -9.9805e-01,
             2.6880e-01, -7.0312e-01],
           [ 1.6797e-01, -6.9385e-01, -8.6279e-01,  ...,  6.8115e-01,
             6.4502e-01, -1.9714e-02],
           [-1.5259e-02,  6.8701e-01,  1.7102e-01,  ..., -5.3076e-01,
             5.5115e-02, -6.6650e-02]],

          [[ 6.2939e-01,  9.9316e-01,  9.0771e-01,  ...,  1.6035e+00,
            -1.0723e+00,  1.6006e+00],
           [ 2.2891e+00,  1.5161e-01,  2.0664e+00,  ..., -8.8916e-01,
             1.1094e+00,  5.9766e-01],
           [-4.3652e-01,  4.6045e-01,  3.5815e-01,  ...,  1.7480e-01,
            -1.0586e+00, -1.2236e+00]],

          [[ 1.0029e+00,  7.2363e-01, -1.6221e+00,  ..., -8.0127e-01,
            -1.7139e-01,  9.5398e-02],
           [ 1.5381e+00, -4.3262e-01,  8.8086e-01,  ..., -1.4941e-01,
            -9.0381e-01, -2.3792e-01],
           [-1.5645e+00,  5.0316e-03,  1.5742e+00,  ..., -2.1250e+00,
             8.3447e-01,  9.3066e-01]],

          ...,

          [[ 2.1350e-01,  1.3545e+00, -2.4805e+00,  ..., -1.5540e-01,
             3.2135e-02,  3.4863e-01],
           [-6.0156e-01,  5.1562e-01,  1.3057e+00,  ..., -1.2832e+00,
            -5.4248e-01,  2.0918e+00],
           [ 9.8267e-02, -6.6309e-01,  3.8428e-01,  ..., -8.3447e-01,
             1.1047e-02,  1.5469e+00]],

          [[-1.0869e+00,  1.7344e+00,  1.2520e+00,  ..., -6.7810e-02,
            -4.6509e-01,  1.0137e+00],
           [-4.5654e-01, -1.0801e+00, -1.9775e-01,  ...,  1.9336e-01,
             1.4844e+00,  6.3525e-01],
           [-3.5718e-01,  5.0342e-01, -4.2676e-01,  ..., -1.1084e+00,
            -5.1221e-01, -5.6787e-01]],

          [[ 2.9834e-01, -1.1328e+00, -7.1533e-01,  ..., -9.0332e-02,
            -3.0460e-03, -5.7422e-01],
           [-2.3184e+00,  1.7061e+00,  1.2871e+00,  ...,  2.0039e+00,
             8.4033e-01,  2.3694e-01],
           [-1.6240e+00,  5.4688e-01, -2.0483e-01,  ...,  1.0098e+00,
            -1.2793e+00, -1.1035e+00]]],


         [[[-1.5234e+00,  3.3716e-01,  1.2305e+00,  ...,  1.4236e-02,
            -5.8105e-01,  2.8833e-01],
           [ 1.1738e+00, -1.2783e+00, -6.9727e-01,  ..., -8.8574e-01,
            -1.2539e+00, -6.7676e-01],
           [-6.7017e-02,  1.3794e-01, -5.8789e-01,  ...,  3.1641e+00,
             2.6055e+00, -1.2637e+00]],

          [[ 9.0723e-01,  3.0737e-01, -1.4688e+00,  ..., -4.5874e-01,
             1.3486e+00, -1.0361e+00],
           [-8.7793e-01, -5.5762e-01,  5.4688e-01,  ..., -8.4570e-01,
            -2.2595e-01,  1.3174e+00],
           [-1.4219e+00,  1.5674e+00, -2.8857e-01,  ...,  1.2268e-01,
            -1.1865e+00,  1.8359e+00]],

          [[-7.8857e-01,  8.6914e-01,  1.6577e-01,  ...,  5.7520e-01,
            -6.3770e-01,  1.2959e+00],
           [ 8.3398e-01, -3.3203e-01,  1.6113e+00,  ..., -4.3433e-01,
            -8.0420e-01, -9.3750e-02],
           [-8.7744e-01,  7.6416e-01,  1.5430e+00,  ...,  1.7654e-02,
             2.0117e-01, -5.3174e-01]],

          ...,

          [[ 7.3438e-01,  4.5215e-01, -7.1777e-01,  ..., -1.7646e+00,
            -1.0565e-01, -7.4951e-01],
           [-3.7207e-01,  1.3770e+00, -3.0957e-01,  ..., -3.7085e-01,
            -2.2119e-01,  3.8635e-02],
           [ 9.1895e-01, -1.7529e-01,  1.5068e+00,  ..., -3.2153e-01,
             4.9707e-01, -1.8740e+00]],

          [[-2.4492e+00,  4.6606e-01,  4.9292e-01,  ..., -1.1060e-01,
             2.0691e-01, -4.6533e-01],
           [ 1.3096e+00, -4.3530e-01,  1.6321e-01,  ..., -1.8203e+00,
            -8.5986e-01,  2.0938e+00],
           [-1.5459e+00,  1.3369e+00, -4.9927e-01,  ...,  3.3594e-01,
            -5.2148e-01,  7.3828e-01]],

          [[ 8.3057e-01,  6.5625e-01, -4.5728e-01,  ..., -5.7953e-02,
             1.5587e-02,  1.9727e+00],
           [ 1.3701e+00,  7.6514e-01, -3.2397e-01,  ..., -6.4551e-01,
            -1.9531e+00,  1.0309e-01],
           [ 7.5977e-01,  6.2988e-02, -2.4963e-01,  ..., -2.1985e-01,
             1.0176e+00,  2.4207e-01]]],


         ...,


         [[[-1.0358e-01,  1.2656e+00, -2.6387e+00,  ...,  9.2188e-01,
            -2.4353e-01, -1.4473e+00],
           [ 9.1699e-01, -2.1143e-01, -6.0107e-01,  ...,  4.5532e-01,
             6.2305e-01,  1.1553e+00],
           [ 1.4482e+00,  2.0361e-01,  1.7812e+00,  ..., -5.9521e-01,
            -6.6406e-01,  7.7686e-01]],

          [[ 7.8223e-01,  3.5400e-01,  1.3027e+00,  ..., -1.7590e-01,
            -9.8389e-01,  3.5205e-01],
           [ 8.0518e-01, -1.1543e+00, -1.4922e+00,  ...,  5.0537e-01,
            -1.1465e+00, -9.3701e-01],
           [ 8.0859e-01,  7.4219e-01,  9.6729e-01,  ..., -7.1899e-02,
             1.2334e+00, -2.7852e+00]],

          [[ 8.7109e-01,  1.3159e-01, -5.2197e-01,  ..., -6.3232e-01,
            -2.0813e-01, -1.3359e+00],
           [ 1.8677e-01,  1.9302e-02,  1.3213e+00,  ...,  9.3140e-02,
            -2.9614e-01, -1.2256e+00],
           [-2.1265e-01,  1.1533e+00, -2.0081e-02,  ..., -1.1182e+00,
            -3.2617e-01, -2.6929e-01]],

          ...,

          [[ 2.7808e-01, -9.2285e-01, -7.5439e-01,  ..., -3.5181e-01,
             3.9558e-03,  2.2412e-01],
           [ 1.3164e+00, -4.9500e-02,  1.3301e+00,  ..., -1.3916e+00,
             7.1289e-01,  1.5820e+00],
           [ 5.5078e-01,  4.9023e-01, -1.0459e+00,  ...,  5.8441e-02,
            -2.2617e+00, -9.2529e-01]],

          [[ 4.8340e-01, -1.1240e+00,  1.3975e+00,  ..., -1.0187e-01,
            -8.5791e-01, -1.0413e-01],
           [-4.7144e-01,  4.7461e-01,  2.2441e+00,  ..., -1.5156e+00,
            -6.3599e-02,  9.1357e-01],
           [ 1.9961e+00, -2.5547e+00, -4.6289e-01,  ...,  5.4883e-01,
            -1.1139e-01,  5.3027e-01]],

          [[ 6.9189e-01,  1.0999e-01, -3.3740e-01,  ...,  2.4268e-01,
             1.3535e+00,  1.0654e+00],
           [-1.0020e+00,  5.0507e-02, -9.1650e-01,  ...,  1.5459e+00,
            -3.6108e-01, -9.4189e-01],
           [-4.3427e-02, -6.2988e-01, -1.1006e+00,  ..., -6.8555e-01,
            -4.8145e-01,  3.6646e-01]]],


         [[[ 9.2468e-02, -3.5934e-03, -6.3916e-01,  ..., -7.5586e-01,
             8.7744e-01, -7.5439e-01],
           [ 2.8467e-01, -4.9780e-01, -6.6943e-01,  ...,  1.8877e+00,
             1.6370e-01,  5.3320e-01],
           [ 1.0371e+00,  9.1797e-01,  6.9141e-01,  ...,  7.2656e-01,
             1.0723e+00, -2.2812e+00]],

          [[ 7.4463e-01, -1.0586e+00,  7.0068e-01,  ..., -1.0684e+00,
             4.3994e-01, -6.8945e-01],
           [-9.5605e-01, -8.2703e-02,  2.7563e-01,  ..., -7.6562e-01,
            -3.9331e-01, -1.7656e+00],
           [ 2.0117e+00,  2.5610e-01, -1.8982e-01,  ..., -3.6499e-01,
            -2.2031e+00, -1.6260e-01]],

          [[ 1.4697e+00,  1.2360e-01,  5.7520e-01,  ...,  1.5173e-01,
             6.8506e-01,  6.8799e-01],
           [-1.0391e+00,  3.4473e-01,  4.5288e-01,  ..., -8.2031e-01,
             1.7021e+00, -2.8477e+00],
           [-3.4570e-01, -6.4355e-01,  5.5664e-01,  ..., -1.7275e+00,
             8.4668e-01,  3.0127e-01]],

          ...,

          [[ 9.8389e-01, -1.1367e+00, -8.3887e-01,  ...,  1.0049e+00,
             1.7793e+00, -1.8486e+00],
           [-1.3535e+00, -4.2358e-01, -2.8882e-01,  ...,  1.0664e+00,
            -3.8013e-01, -1.1230e+00],
           [-1.3306e-02,  1.2100e+00, -1.9775e+00,  ...,  4.8315e-01,
             1.4551e+00, -3.5352e-01]],

          [[ 2.3328e-01,  1.0078e+00,  1.3770e+00,  ...,  1.5107e+00,
            -7.4707e-01, -1.1172e+00],
           [ 6.3867e-01, -1.0928e+00, -5.6982e-01,  ...,  5.5206e-02,
             1.7490e+00, -1.0332e+00],
           [-8.4033e-01, -1.2061e+00,  3.8110e-01,  ..., -9.7314e-01,
            -1.9934e-01,  5.2246e-01]],

          [[ 9.1370e-02, -1.0947e+00,  9.2285e-02,  ...,  1.5625e-01,
             3.3032e-01, -3.8818e-01],
           [-1.2471e+00, -3.4302e-01,  4.8676e-02,  ...,  3.4912e-01,
             1.0449e+00,  7.0068e-01],
           [ 1.1865e-01, -1.4746e+00,  1.4541e+00,  ...,  3.3423e-01,
            -7.5439e-01, -1.3262e+00]]],


         [[[-1.1064e+00, -1.2705e+00,  1.2363e+00,  ...,  1.5410e+00,
            -2.5122e-01,  9.2480e-01],
           [-1.5693e+00, -6.9043e-01, -1.7012e+00,  ..., -2.2998e-01,
             1.1904e+00, -3.4204e-01],
           [ 8.3984e-01,  3.1250e-01, -2.8857e-01,  ..., -2.1250e+00,
            -8.1055e-01, -7.6514e-01]],

          [[ 4.6631e-01, -6.1865e-01,  8.9600e-01,  ...,  2.8271e-01,
             8.8184e-01, -1.0146e+00],
           [-1.4170e+00,  1.7979e+00, -2.9858e-01,  ...,  1.1797e+00,
             8.4082e-01,  3.4253e-01],
           [ 1.9214e-01, -4.2603e-01,  1.0361e+00,  ..., -1.1201e+00,
             4.4458e-01,  1.2412e+00]],

          [[-4.9634e-01,  2.9590e-01,  1.5601e-01,  ..., -1.2373e+00,
             1.0439e+00,  1.3027e+00],
           [ 1.5723e+00, -2.1228e-01,  7.1289e-01,  ...,  4.2334e-01,
            -7.4658e-01,  1.0498e+00],
           [-8.5254e-01, -2.0449e+00,  6.9727e-01,  ...,  6.4258e-01,
             1.1846e+00, -4.2334e-01]],

          ...,

          [[ 5.1074e-01, -1.3806e-01,  1.6895e-01,  ..., -8.3447e-01,
             1.3096e+00,  1.8408e+00],
           [ 1.0381e+00, -1.1318e+00,  1.1748e+00,  ..., -7.0703e-01,
             1.8965e+00,  3.0347e-01],
           [-1.4404e+00, -9.4971e-01,  1.8486e+00,  ...,  1.8750e+00,
            -8.1348e-01, -2.9907e-01]],

          [[ 1.2042e-01, -4.1406e-01, -1.5420e+00,  ..., -8.2373e-01,
            -1.6738e+00, -6.6455e-01],
           [-4.0527e-01,  4.1040e-01,  8.5303e-01,  ...,  1.1494e+00,
            -2.3767e-01,  5.9131e-01],
           [-7.3975e-01,  4.3872e-01,  8.5327e-02,  ..., -5.1465e-01,
            -1.1504e+00,  3.4937e-01]],

          [[-7.5537e-01, -1.8854e-03, -1.1797e+00,  ..., -9.9609e-01,
             3.9160e-01,  2.1133e+00],
           [-2.9199e-01, -3.0981e-01, -3.1543e-01,  ..., -1.4395e+00,
             2.2852e+00,  4.8169e-01],
           [-1.9570e+00,  6.7627e-01, -3.8037e-01,  ...,  2.9321e-01,
             3.5938e-01, -5.3613e-01]]]],



        [[[[ 2.1912e-01,  5.3418e-01,  4.1626e-01,  ..., -5.8203e-01,
             1.4463e+00, -2.0469e+00],
           [ 5.2441e-01,  6.5820e-01,  1.3643e+00,  ..., -6.1890e-02,
            -1.2725e+00, -9.1187e-02],
           [-1.4043e+00, -1.2817e-01,  5.0830e-01,  ...,  4.4092e-01,
            -2.4646e-01, -3.0420e-01]],

          [[-8.5205e-02, -1.1377e+00, -1.9072e+00,  ...,  1.3794e-01,
             7.4365e-01,  3.2666e-01],
           [ 4.5825e-01,  1.6003e-01,  1.3350e+00,  ..., -4.2847e-01,
            -1.1890e-01, -1.2451e+00],
           [ 7.5684e-01, -2.1934e+00, -1.0608e-01,  ...,  9.9792e-02,
            -1.1924e+00,  8.5107e-01]],

          [[ 1.2781e-01, -1.4268e+00,  1.1729e+00,  ..., -3.9917e-01,
            -5.9473e-01,  1.1438e-01],
           [ 3.1470e-01,  9.8511e-02,  2.8305e-03,  ..., -1.2422e+00,
             5.6055e-01, -9.5752e-01],
           [-2.1270e+00,  3.2886e-01, -7.0264e-01,  ..., -1.6709e+00,
            -1.4136e-01, -1.6797e-01]],

          ...,

          [[ 6.5088e-01,  3.2202e-01, -4.5288e-01,  ...,  8.5791e-01,
             3.4497e-01, -8.7402e-01],
           [ 5.3320e-01, -3.0981e-01,  2.8296e-01,  ...,  2.9629e+00,
             1.4873e+00, -3.6841e-01],
           [ 6.8909e-02, -6.5332e-01, -6.8262e-01,  ..., -1.6553e-01,
             6.0547e-01,  8.4668e-01]],

          [[ 1.6875e+00, -3.5327e-01, -2.1309e+00,  ..., -1.8713e-01,
            -1.0527e+00,  1.3213e+00],
           [-6.9238e-01, -6.2439e-02, -3.2764e-01,  ...,  1.0211e-01,
             1.6270e+00,  1.7990e-02],
           [-3.3813e-01,  6.9678e-01, -4.5044e-01,  ...,  3.8428e-01,
             1.6855e+00,  3.7671e-01]],

          [[-2.7271e-01, -3.1055e-01,  6.7920e-01,  ..., -3.0347e-01,
             7.1094e-01,  7.0264e-01],
           [ 7.0312e-01, -1.2148e+00,  5.1611e-01,  ..., -6.6748e-01,
            -1.8662e+00, -5.0098e-01],
           [ 1.6885e+00,  1.2148e+00,  1.6388e-02,  ...,  7.8613e-01,
            -1.4238e+00,  4.4263e-01]]],


         [[[-1.1201e+00,  2.7515e-01,  1.7012e+00,  ..., -6.4893e-01,
            -4.2969e-01, -1.3367e-01],
           [-1.0342e+00, -6.9141e-01, -2.3718e-01,  ..., -4.6631e-01,
             1.8320e+00, -9.3262e-01],
           [-2.0625e+00,  8.9014e-01, -5.1025e-01,  ..., -3.1177e-01,
            -4.6729e-01, -2.7954e-01]],

          [[ 1.9082e+00, -3.3252e-01,  9.4580e-01,  ...,  2.6953e-01,
            -2.0496e-01, -3.1445e-01],
           [ 6.6943e-01, -1.1240e+00,  7.2461e-01,  ..., -1.4033e+00,
            -8.2764e-01, -1.9834e+00],
           [ 3.6621e-02,  3.0176e-01, -1.3867e+00,  ..., -9.5752e-01,
             4.4019e-01, -1.3730e+00]],

          [[-2.3453e-02,  7.2266e-01,  7.2852e-01,  ...,  3.3057e-01,
             6.3672e-01, -7.2900e-01],
           [ 4.5605e-01,  7.7832e-01,  1.1836e+00,  ...,  9.7656e-01,
            -1.1416e+00,  1.5361e+00],
           [ 8.1494e-01, -1.2725e+00,  6.2891e-01,  ...,  2.3926e+00,
            -1.1395e-01, -1.9531e+00]],

          ...,

          [[-1.0293e+00,  3.3179e-01,  7.9248e-01,  ..., -7.2070e-01,
             4.7363e-01, -3.8062e-01],
           [-3.4644e-01,  7.5098e-01, -1.6882e-01,  ...,  1.5352e+00,
            -6.2744e-01, -1.1017e-01],
           [-8.1982e-01, -9.4824e-01,  8.0371e-01,  ...,  3.4399e-01,
            -1.2390e-01, -2.1509e-01]],

          [[-1.0264e+00, -1.2441e+00, -1.8809e+00,  ...,  2.9639e-01,
             6.5283e-01, -1.0674e-02],
           [-1.7930e+00, -1.1562e+00,  1.1505e-02,  ...,  4.4116e-01,
            -8.9404e-01,  1.6514e+00],
           [ 2.4141e+00,  1.5839e-02, -2.6196e-01,  ...,  1.3750e+00,
            -7.4805e-01, -5.3613e-01]],

          [[-1.5986e+00,  1.3838e+00,  1.5029e+00,  ..., -2.8345e-01,
            -3.1274e-01, -3.0786e-01],
           [-1.0651e-01,  1.2578e+00, -9.6143e-01,  ...,  1.2041e+00,
             2.5371e+00,  2.4011e-01],
           [-1.2568e+00, -3.8696e-01,  8.3105e-01,  ..., -5.2686e-01,
            -8.7305e-01, -7.9248e-01]]],


         [[[ 9.9414e-01, -6.7566e-02, -3.0981e-01,  ..., -5.2979e-01,
            -3.9648e-01, -6.7236e-01],
           [-4.2383e-01, -3.6230e-01,  4.2407e-01,  ...,  1.3789e+00,
             7.2607e-01,  9.7852e-01],
           [ 2.0820e+00, -1.7207e+00, -4.2651e-01,  ...,  7.5928e-01,
             6.9336e-01,  2.0176e+00]],

          [[ 7.4805e-01, -1.0195e+00,  1.7871e-01,  ...,  1.6602e+00,
            -1.7393e+00, -4.6484e-01],
           [ 5.0146e-01,  1.1699e+00, -3.4766e-01,  ..., -1.3887e+00,
             7.0984e-02, -7.5781e-01],
           [-3.3032e-01, -1.1322e-01, -1.6638e-01,  ..., -2.1445e+00,
            -8.6719e-01, -3.5205e-01]],

          [[-8.5205e-01,  1.4648e+00,  4.0649e-01,  ...,  5.0635e-01,
             9.3896e-01, -4.5508e-01],
           [-2.1057e-01,  6.4355e-01, -5.6836e-01,  ...,  9.2188e-01,
             5.0598e-02, -6.2378e-02],
           [-8.4717e-01, -4.4458e-01, -1.5342e+00,  ..., -4.2651e-01,
            -3.1543e-01, -4.2822e-01]],

          ...,

          [[ 9.1895e-01, -1.6426e+00,  5.0830e-01,  ...,  6.0449e-01,
             1.5332e+00, -5.9863e-01],
           [ 4.4525e-02, -2.7808e-01, -1.1494e+00,  ..., -1.0996e+00,
            -1.2266e+00,  1.0576e+00],
           [ 7.5830e-01,  1.2178e+00, -1.4832e-01,  ...,  2.0879e+00,
             2.4524e-01, -6.9482e-01]],

          [[ 8.4766e-01,  4.6533e-01, -2.1619e-01,  ...,  1.4331e-01,
             1.1279e+00, -5.3711e-01],
           [ 3.4729e-02,  8.3398e-01,  5.6982e-01,  ...,  8.7891e-01,
             6.5479e-01, -1.1719e+00],
           [ 2.3975e-01, -2.5078e+00,  1.6406e+00,  ...,  1.4258e-01,
             9.0820e-02, -5.8984e-01]],

          [[-5.1117e-02, -4.4067e-02,  1.3057e+00,  ..., -2.6733e-01,
             1.6240e+00, -1.0859e+00],
           [-7.1729e-01,  1.0469e+00,  5.5420e-01,  ...,  4.8004e-02,
             9.3689e-02, -9.0674e-01],
           [ 3.0786e-01, -8.3594e-01, -5.6494e-01,  ...,  4.7070e-01,
             4.0625e-01,  1.5078e+00]]],


         ...,


         [[[-3.3838e-01,  5.6787e-01, -1.1436e+00,  ...,  4.4482e-01,
            -1.1436e+00,  2.0000e+00],
           [-2.5610e-01,  8.1396e-01,  1.7559e+00,  ..., -5.7520e-01,
            -6.0938e-01, -1.5784e-01],
           [-1.2422e+00,  6.3037e-01, -6.0742e-01,  ..., -1.9697e+00,
            -1.1572e+00,  5.8838e-01]],

          [[-9.9219e-01,  6.0449e-01,  3.1421e-01,  ...,  9.6582e-01,
             3.2031e-01, -1.7624e-02],
           [ 5.1123e-01,  2.7054e-02,  7.0605e-01,  ..., -1.5662e-01,
             1.7783e+00, -2.5162e-02],
           [-4.6704e-01, -9.4971e-01, -8.4619e-01,  ...,  8.2617e-01,
             1.9617e-01, -7.1631e-01]],

          [[ 2.0239e-01,  7.1143e-01, -3.1787e-01,  ...,  6.1377e-01,
            -7.8027e-01, -1.3291e+00],
           [ 1.1240e+00, -6.8848e-01,  3.9673e-01,  ...,  1.3848e+00,
             9.0137e-01,  2.2656e+00],
           [-3.4326e-01, -3.0298e-01,  5.1123e-01,  ...,  3.7109e-01,
            -1.3489e-01,  1.7832e+00]],

          ...,

          [[-2.6113e+00, -1.8271e+00, -9.5850e-01,  ..., -1.0791e-01,
            -1.5088e-01,  2.3926e+00],
           [ 2.4316e-01,  1.0297e-01, -3.2520e-01,  ...,  7.8174e-01,
             2.7368e-01, -1.2048e-01],
           [ 1.0869e+00,  1.0315e-02,  1.3369e+00,  ..., -4.6802e-01,
             5.1367e-01, -4.3726e-01]],

          [[-8.6035e-01, -2.1758e+00,  2.6978e-01,  ...,  1.3164e+00,
            -7.2021e-01, -1.5613e-01],
           [-8.8916e-01,  1.2207e+00, -6.3843e-02,  ...,  2.9126e-01,
            -9.6533e-01, -9.0430e-01],
           [ 4.5239e-01, -4.8804e-01,  4.7656e-01,  ..., -1.6338e+00,
             3.2153e-01, -2.6738e+00]],

          [[ 1.1504e+00,  1.3940e-01,  2.3633e-01,  ...,  6.8542e-02,
             5.1953e-01,  4.3213e-01],
           [-3.3179e-01,  5.2979e-01, -4.9561e-01,  ..., -2.9824e+00,
            -1.6826e+00, -5.5029e-01],
           [-2.6929e-01, -2.3848e+00,  9.3066e-01,  ..., -9.0454e-02,
             1.0049e+00,  9.8193e-01]]],


         [[[ 4.3848e-01,  8.4033e-01, -1.4590e+00,  ..., -2.7393e-01,
            -9.3323e-02, -1.9111e+00],
           [ 4.7485e-01, -3.6230e-01, -9.5020e-01,  ...,  2.6880e-01,
             1.8184e+00, -1.2715e+00],
           [ 5.8252e-01,  6.0089e-02,  1.1943e+00,  ...,  1.5137e-01,
            -6.4746e-01, -8.7500e-01]],

          [[ 2.7124e-01,  4.0430e-01,  6.4502e-01,  ...,  1.0400e+00,
            -5.5273e-01, -7.7588e-01],
           [ 1.1729e+00,  7.9932e-01,  4.4971e-01,  ..., -4.3774e-01,
             8.1104e-01, -4.4336e-01],
           [-1.5586e+00, -2.3206e-01, -9.6289e-01,  ..., -7.8662e-01,
             2.1328e+00,  3.5132e-01]],

          [[ 2.0251e-01,  1.8389e+00,  1.2988e+00,  ...,  7.2314e-01,
            -9.3613e-03, -1.5625e-01],
           [ 1.7908e-01,  7.4951e-01, -5.3418e-01,  ...,  1.3145e+00,
             1.6289e+00,  1.8555e+00],
           [ 4.8535e-01,  6.7480e-01, -6.0205e-01,  ..., -8.7158e-01,
             1.9336e-01,  6.0107e-01]],

          ...,

          [[ 1.2549e+00,  8.0078e-01, -8.2178e-01,  ...,  1.0565e-01,
             9.3750e-01,  2.5757e-01],
           [-9.0479e-01, -1.6572e+00, -3.1982e-01,  ...,  3.6987e-02,
            -2.1558e-01, -6.9727e-01],
           [ 8.4131e-01,  7.9688e-01, -3.9673e-01,  ..., -5.3369e-01,
             1.3623e+00,  2.6562e-01]],

          [[-4.3579e-02,  2.9541e-01, -5.7520e-01,  ...,  7.8809e-01,
             1.3145e+00, -3.6768e-01],
           [ 1.6484e+00, -4.0161e-01,  7.1875e-01,  ...,  4.9658e-01,
             2.5928e-01,  2.9175e-01],
           [ 2.6777e+00,  6.0938e-01,  7.0166e-01,  ...,  1.0797e-01,
             7.1289e-01, -1.7700e-01]],

          [[ 1.4482e+00,  1.3516e+00,  1.4346e+00,  ..., -5.9570e-01,
            -2.3281e+00,  5.6104e-01],
           [ 7.8662e-01, -1.5686e-01, -7.8906e-01,  ...,  1.1737e-01,
             6.0449e-01, -7.7930e-01],
           [ 4.5947e-01,  1.2617e+00,  3.4937e-01,  ...,  1.6223e-01,
            -2.8638e-01, -7.0654e-01]]],


         [[[ 1.1045e+00,  2.8418e+00, -1.8906e+00,  ...,  2.6807e-01,
             6.7188e-01,  1.3525e-01],
           [-2.8149e-01,  3.8281e-01,  8.6523e-01,  ..., -2.4573e-01,
            -5.3857e-01, -2.2659e-03],
           [ 5.7422e-01,  1.3171e-01,  4.3213e-01,  ...,  9.7656e-01,
            -6.1621e-01,  8.1445e-01]],

          [[ 1.1719e-01,  1.7490e+00,  8.4778e-02,  ..., -3.8330e-01,
            -1.5000e+00,  1.6025e+00],
           [ 3.1934e-01, -6.2408e-02,  2.0293e+00,  ...,  5.1758e-01,
             9.7705e-01, -9.6045e-01],
           [ 7.1631e-01, -8.5400e-01, -1.3733e-01,  ...,  4.7852e-01,
            -4.4824e-01, -9.5605e-01]],

          [[ 1.4033e+00,  1.2617e+00,  9.8340e-01,  ..., -1.4600e-01,
            -3.4607e-02, -1.2505e-02],
           [ 1.2412e+00, -1.6003e-01,  1.3428e+00,  ..., -1.1279e+00,
             9.2139e-01, -1.2910e+00],
           [ 9.0479e-01, -1.1487e-01, -3.2544e-01,  ...,  1.9258e+00,
             1.0557e+00,  1.6719e+00]],

          ...,

          [[-5.4248e-01, -1.4551e-01,  1.1896e-01,  ..., -8.5498e-01,
             4.4165e-01, -1.9082e+00],
           [-9.3018e-01, -6.2842e-01, -3.9355e-01,  ..., -3.2690e-01,
            -6.9678e-01, -7.8906e-01],
           [ 6.3086e-01, -8.9160e-01, -3.3154e-01,  ..., -8.8135e-01,
            -1.3389e+00,  6.4600e-01]],

          [[-2.3145e-01,  1.4575e-01,  5.6641e-01,  ..., -1.7998e+00,
            -1.4883e+00, -4.1357e-01],
           [ 2.9062e+00,  1.8330e+00,  1.2148e+00,  ...,  6.8750e-01,
            -1.9727e+00, -6.1378e-03],
           [ 7.2949e-01, -4.6997e-01, -1.0801e+00,  ..., -4.7339e-01,
             4.7925e-01, -4.8242e-01]],

          [[ 1.8057e+00,  4.5502e-02,  7.7686e-01,  ..., -1.6816e+00,
            -1.6279e+00, -9.3896e-01],
           [ 7.2461e-01, -2.9551e+00,  8.4778e-02,  ...,  1.0586e+00,
             3.2129e-01, -6.4600e-01],
           [ 7.1631e-01,  5.2460e-02, -6.2061e-01,  ..., -5.4688e-01,
             1.3984e+00,  9.9258e-03]]]]], device='cuda:0',
       dtype=torch.float16, requires_grad=True)
out = tensor([[[[ 2.6871e-02, -3.4332e-02, -1.1469e-01,  ..., -3.6194e-02,
            2.1317e-02,  8.1177e-02],
          [-3.8635e-02, -3.6931e-04,  2.1851e-02,  ..., -2.3529e-02,
           -2.9617e-02, -1.3086e-01],
          [ 2.8687e-02,  1.3723e-03,  5.0140e-02,  ...,  2.7313e-03,
            1.2720e-01, -7.2021e-02]],

         [[ 1.1340e-01,  9.1675e-02, -4.6682e-04,  ...,  2.6764e-02,
            1.3525e-01, -2.0142e-02],
          [-1.4502e-01, -3.2593e-02, -7.7087e-02,  ..., -9.6680e-02,
           -8.0811e-02,  7.1045e-02],
          [ 1.2384e-01,  3.2990e-02,  4.4464e-02,  ...,  2.8137e-02,
            1.0643e-02,  1.5732e-02]],

         [[ 5.6824e-02, -2.0905e-02,  6.2523e-03,  ...,  2.2079e-02,
            5.8838e-02, -2.5238e-02],
          [ 2.3270e-03, -8.5815e-02, -1.7761e-02,  ..., -6.6772e-02,
           -5.8136e-02, -6.2561e-02],
          [-2.7359e-02,  8.7830e-02,  8.1238e-02,  ...,  4.1290e-02,
            1.2115e-01, -6.7627e-02]],

         ...,

         [[-4.5052e-03,  4.6051e-02, -5.2582e-02,  ...,  9.2651e-02,
            7.4341e-02,  9.9792e-02],
          [-1.3928e-01, -2.7161e-02, -6.5193e-03,  ..., -3.3936e-02,
           -1.2955e-02, -1.0071e-01],
          [-9.2773e-02, -1.1053e-01,  1.2048e-01,  ...,  5.0934e-02,
            4.6173e-02, -1.1124e-02]],

         [[ 6.1493e-02, -7.6914e-04,  1.1589e-02,  ..., -4.2450e-02,
            8.7585e-03,  2.3003e-03],
          [-7.3975e-02, -9.1797e-02, -4.5593e-02,  ..., -7.4463e-02,
            7.9498e-03,  5.6030e-02],
          [ 6.1340e-02,  1.6113e-02,  5.7434e-02,  ...,  8.0139e-02,
            1.3318e-01, -9.6558e-02]],

         [[ 5.9753e-02,  1.6373e-02, -5.5511e-02,  ...,  3.2288e-02,
            4.5044e-02,  1.2375e-02],
          [ 1.8244e-03, -5.3436e-02, -3.8910e-03,  ..., -5.0735e-03,
           -1.9363e-02, -8.3862e-02],
          [-3.1242e-03, -2.8290e-02,  6.1523e-02,  ...,  3.3508e-02,
            2.4963e-02, -4.7119e-02]]],


        [[[-4.7638e-02, -3.0060e-02, -1.0242e-01,  ...,  8.0566e-02,
            2.9984e-02,  6.1218e-02],
          [ 3.3020e-02, -9.0576e-02, -6.1890e-02,  ...,  2.9221e-02,
           -2.9404e-02, -4.1199e-02],
          [ 6.5346e-03, -2.0142e-03,  7.1899e-02,  ...,  5.4077e-02,
            1.0468e-02, -1.9440e-02]],

         [[ 3.0487e-02, -6.2561e-02, -7.0457e-03,  ...,  7.9651e-02,
            9.0881e-02,  6.7520e-03],
          [-3.4943e-02,  1.2326e-04, -5.0385e-02,  ..., -3.9551e-02,
            2.7283e-02,  2.0828e-02],
          [ 6.7810e-02,  9.8633e-02, -8.1100e-03,  ..., -3.3447e-02,
           -7.6721e-02,  3.9612e-02]],

         [[-2.3605e-02,  8.0383e-02, -5.4779e-02,  ...,  1.2426e-03,
           -9.9258e-03,  6.2225e-02],
          [ 4.0070e-02, -1.3464e-01, -4.1626e-02,  ..., -2.1133e-02,
           -4.1656e-02, -7.0557e-02],
          [ 7.9041e-02, -4.5197e-02,  4.4189e-02,  ...,  2.0355e-02,
           -1.0010e-02, -7.8430e-02]],

         ...,

         [[ 1.5228e-02,  2.2278e-02,  2.9831e-02,  ...,  1.0773e-01,
           -4.2076e-03, -1.3214e-02],
          [ 6.3293e-02, -7.7332e-02,  1.4238e-03,  ..., -9.1705e-03,
            1.2398e-02, -7.6782e-02],
          [ 3.9825e-02, -1.1346e-01, -5.3894e-02,  ...,  3.3203e-02,
            3.9246e-02, -4.4739e-02]],

         [[-4.4037e-02,  1.9073e-02, -9.9060e-02,  ..., -7.9193e-03,
            2.1133e-02, -1.8631e-02],
          [-7.6981e-03, -7.2876e-02, -4.7722e-03,  ...,  2.4509e-03,
            2.6840e-02, -1.1542e-01],
          [ 7.0618e-02, -2.3136e-03,  9.1919e-02,  ...,  3.2759e-04,
           -3.6926e-03,  2.2476e-02]],

         [[-2.8992e-02,  2.6062e-02,  6.2622e-02,  ..., -1.8402e-02,
           -2.9694e-02, -8.4839e-02],
          [-1.6556e-03, -8.3130e-02, -1.7651e-01,  ..., -3.6560e-02,
           -1.4656e-02,  2.8687e-02],
          [ 1.1096e-01, -1.3977e-02,  7.9803e-03,  ...,  5.3253e-02,
            4.3610e-02, -5.1880e-02]]]], device='cuda:0', dtype=torch.float16,
       grad_fn=<FlashAttnQKVPackedFuncBackward>)
lse = tensor([[[7.4046, 7.5581, 7.2916,  ..., 7.5382, 7.2865, 7.3321],
         [7.4613, 7.5346, 7.3848,  ..., 7.4243, 7.3426, 7.1901],
         [7.3065, 7.4389, 7.6685,  ..., 7.4810, 7.3615, 7.4580]],

        [[7.6336, 7.3400, 7.4429,  ..., 7.3694, 7.4997, 7.4404],
         [7.3844, 7.3770, 7.4724,  ..., 7.5661, 7.5705, 7.6055],
         [7.3520, 7.5876, 7.5335,  ..., 7.3522, 7.3807, 7.4182]]],
       device='cuda:0', grad_fn=<FlashAttnQKVPackedFuncBackward>)
S_dmask = tensor([[[[ 0.3081, -0.0560,  0.0224,  ...,  0.3232, -0.1556,  0.2529],
          [ 0.0382,  0.0952,  0.0225,  ...,  0.8638,  0.1246, -0.0871],
          [ 0.1353,  0.0703, -0.0743,  ...,  0.1165,  0.1611,  0.0293],
          ...,
          [ 0.1243,  0.0168,  0.0503,  ...,  0.1355, -0.0492,  0.1239],
          [ 0.0567,  0.0414,  0.0472,  ...,  0.0038,  0.1267,  0.0174],
          [-0.1090,  0.1433,  0.1179,  ...,  0.0322,  0.0554, -0.1422]],

         [[ 0.2435,  0.0343,  0.2208,  ...,  0.1633,  0.0912,  0.0263],
          [ 0.0217,  0.1140,  0.0054,  ...,  1.0000, -0.0147,  0.1989],
          [ 0.0427, -0.0401,  0.1231,  ...,  0.1547,  0.0430,  0.2834],
          ...,
          [ 0.0461,  0.0101,  0.0479,  ..., -0.1008,  0.0427, -0.5522],
          [ 0.0442, -0.0115,  0.0191,  ..., -0.1389,  0.2739,  0.1301],
          [ 0.0474,  0.0160,  0.0616,  ...,  0.1146,  0.2306,  0.2815]],

         [[ 0.0386,  0.1215,  0.0315,  ...,  0.0576, -0.1398,  0.0383],
          [ 0.0299, -0.0138,  0.0641,  ...,  0.2012,  0.3196,  0.1569],
          [ 0.2401,  0.0503,  0.0292,  ...,  0.0318,  0.0168,  0.0633],
          ...,
          [ 0.0253,  0.0120,  0.0502,  ...,  0.0425,  0.0183,  0.4321],
          [ 0.0565,  0.0413,  0.0605,  ...,  0.0670,  0.1577, -0.0249],
          [ 0.1376,  0.0101,  0.0139,  ...,  0.2651,  0.0452,  0.3567]]],


        [[[-0.0285,  0.1132,  0.0310,  ...,  0.9316,  0.3687,  0.1847],
          [ 0.0090,  0.1278,  0.1753,  ...,  0.1847,  0.0730,  0.0430],
          [ 0.0527, -0.0116,  0.0173,  ...,  0.0366,  0.1862,  0.0439],
          ...,
          [ 0.0596,  0.0175, -0.0764,  ...,  0.0557, -0.0482,  0.1259],
          [ 0.1184,  0.3428,  0.0687,  ...,  0.1237,  0.0685,  0.1246],
          [ 0.1833,  0.0421,  0.0966,  ..., -0.0400,  0.0269,  0.0488]],

         [[ 0.0192,  0.1066,  0.0896,  ..., -0.0421, -0.0667,  0.0585],
          [ 0.0095, -0.0043,  0.1058,  ...,  0.0975,  0.0370,  0.0139],
          [ 0.1530, -0.1277,  0.0404,  ...,  0.0695,  0.5620, -0.1216],
          ...,
          [ 0.0121,  0.0148,  0.0222,  ...,  0.1082,  0.1017,  0.1028],
          [ 0.0201,  0.0149,  0.0517,  ...,  0.5889,  0.0435,  0.8198],
          [ 0.0780, -0.0474,  0.0353,  ...,  0.1569,  0.0431,  0.0292]],

         [[ 0.1357, -0.0704,  0.3704,  ...,  0.0128,  0.0503,  0.0298],
          [-0.2354,  0.0020,  0.0130,  ...,  0.0633,  0.1025,  0.1383],
          [ 0.0564, -0.0637,  0.0379,  ...,  0.0142,  0.2065,  0.1359],
          ...,
          [ 0.2039,  0.0246, -0.0375,  ...,  0.0569,  0.1798,  0.0324],
          [-0.0556,  0.0167,  0.0827,  ...,  0.3733, -0.0371,  0.0857],
          [ 0.0401,  0.2610,  0.0474,  ...,  0.2957,  0.0745,  0.0291]]]],
       device='cuda:0', dtype=torch.float16,
       grad_fn=<FlashAttnQKVPackedFuncBackward>)
